<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi riết trạm</title>
    <script src="tailwindcss.js"></script>
    <script src="vue.js"></script>
  </head>
  <body>
    <div id="app" v-cloak>
      <div
        class="max-w-3xl m-auto flex justify-center items-center flex-col p-4"
      >
        <h1 class="text-2xl font-bold mb-4">Chi tiết trạm</h1>
        <div class="mb-4 w-full">
          <input
            type="text"
            v-model="searchQuery"
            placeholder="Tìm kiếm module..."
            class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            @input="searchByName()"
          />
        </div>
        <table class="min-w-full border-collapse border border-gray-300">
          <thead>
            <tr class="bg-gray-100">
              <th class="border border-gray-300 px-4 py-2 text-center">STT</th>
              <th class="border border-gray-300 px-4 py-2 text-left">
                Tên module
              </th>
              <th class="border border-gray-300 px-4 py-2 text-pretty">
                Số lượng
              </th>
              <th class="border border-gray-300 px-4 py-2 text-pretty"></th>
            </tr>
          </thead>
          <tbody v-if="displayedItems.length > 0">
            <tr
              v-for="(item, index) in displayedItems"
              :key="item.id"
              class="hover:bg-gray-50"
            >
              <td
                class="border border-gray-300 px-4 py-2 cursor-pointer text-center"
              >
                {{ index + 1 + (currentPage - 1) * size }}
              </td>
              <td
                class="border border-gray-300 px-4 py-2 cursor-pointer"
                @click="goToDetail(item)"
                :title="item.ip"
              >
                {{ item.name }}
              </td>
              <td
                class="border border-gray-300 px-4 py-2 cursor-pointer text-center"
              >
                {{ item.quantity }}
              </td>
              <td
                class="border border-gray-300 px-4 py-2 cursor-pointer text-blue text-xs text-[blue]"
              >
                <div class="flex justify-center">
                  <div class="p-3" @click="goToDetail(item, true)">Ảnh NG</div>
                  <div class="p-3" @click="goToDetail(item, false)">Ảnh Pass</div>
                </div>
              </td>
            </tr>
          </tbody>
          <tbody v-if="displayedItems.length === 0">
            <tr>
              <td colspan="3" class="text-center p-4">Không có dữ liệu</td>
            </tr>
          </tbody>
        </table>
        <div class="mt-4" v-if="totalPages > 1 && searchQuery === ''">
          <button
            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            @click="previousPage"
            :disabled="currentPage === 1"
          >
            Trang trước
          </button>
          <span class="mx-2">Trang {{ currentPage }} / {{ totalPages }}</span>
          <button
            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            @click="nextPage"
            :disabled="currentPage === totalPages"
          >
            Trang sau
          </button>
        </div>
      </div>
      <!-- detail modal NG -->
      <div
        v-if="selectedItem && isNG"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
      >
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-1/2 max-h-[90vh]">
          <div class="p-4 border-b flex justify-between items-center">
            <h3 class="text-lg font-semibold">
              Ảnh NG: {{selectedItem.name}}
            </h3>
            <button
              @click="selectedItem = null"
              class="text-gray-500 hover:text-gray-700"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <div class="p-4 overflow-y-auto">
            <div class="space-y-4">
              <p><strong>Số lượng:</strong> {{selectedItem.quantity}}</p>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div v-for="image in selectedItem.imgNG" class="cursor-pointer">
                  <img :src="image" @click="showFullImage(image)" class="w-full h-32 object-cover rounded">
                </div>
              </div>

              <!-- Full screen image modal -->
              <div v-if="fullImage" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center" @click="fullImage = null" @keyup.esc="fullImage = null" tabindex="0">
                <img :src="fullImage" class="max-h-[90vh] max-w-[90vw] object-contain">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- detail modal PASS -->
      <div
        v-if="selectedItem && !isNG"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
      >
        <div class="bg-white rounded-lg w-11/12 md:w-3/4 lg:w-1/2 max-h-[90vh]">
          <div class="p-4 border-b flex justify-between items-center">
            <h3 class="text-lg font-semibold">
              Ảnh Pass: {{selectedItem.name}}
            </h3>
            <button
              @click="selectedItem = null"
              class="text-gray-500 hover:text-gray-700"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <div class="p-4 overflow-y-auto">
            <div class="space-y-4">
              <p><strong>Số lượng:</strong> {{selectedItem.quantity}}</p>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div v-for="image in selectedItem.imgOK" class="cursor-pointer">
                  <img :src="image" @click="showFullImage(image)" class="w-full h-32 object-cover rounded">
                </div>
              </div>

              <!-- Full screen image modal -->
              <div v-if="fullImage" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center" @click="fullImage = null" @keyup.esc="fullImage = null" tabindex="0">
                <img :src="fullImage" class="max-h-[90vh] max-w-[90vw] object-contain">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <script>
      //new vue app
      const app = Vue.createApp({
        data() {
          return {
            items: [],
            displayedItems: [],
            currentPage: 1,
            size: 1,
            searchQuery: "",
            selectedItem: null,
            fullImage: null,
            isNG: true
          };
        },
        computed: {
          totalPages() {
            return Math.ceil(this.items.length / this.size);
          },
        },
        mounted() {
          this.fetchData();
        },
        methods: {
          fetchData() {
            //get id from request
            const id = new URLSearchParams(window.location.search).get("id");
            fetch(`/tram/${id}.json`)
              .then((response) => response.json())
              .then((data) => {
                this.items = data;
                this.updateDisplayedItems();
              })
              .catch((error) => console.error("Error fetching data:", error));
          },
          previousPage() {
            if (this.currentPage > 1) {
              this.currentPage--;
              this.updateDisplayedItems();
            }
          },
          nextPage() {
            if (this.currentPage < this.totalPages) {
              this.currentPage++;
              this.updateDisplayedItems();
            }
          },
          updateDisplayedItems() {
            const start = (this.currentPage - 1) * this.size;
            const end = start + this.size;
            this.displayedItems = this.items.slice(start, end);
          },
          searchByName() {
            if (this.searchQuery) {
              this.displayedItems = this.items.filter((item) =>
                item.name.toLowerCase().includes(this.searchQuery.toLowerCase())
              );
            } else {
              this.updateDisplayedItems();
            }
          },
          goToDetail(item, isNG) {
            this.selectedItem = item;
            this.isNG = isNG;
          },
          showFullImage(image) {
            this.fullImage = image;
            this.$nextTick(() => {
              document.body.style.overflow = "hidden";
            });
          },
        },
      });
      app.mount("#app");
    </script>
  </body>
</html>
